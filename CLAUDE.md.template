# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

{{PROJECT_DESCRIPTION}} | **Tech Stack:** {{TECH_STACK}}

## Build Commands

```bash
{{BUILD_COMMAND}}   # Build
{{TEST_COMMAND}}    # Run tests
```

## CI/CD Pipeline

CI runs on GitHub Actions:
- `build.yml` -- Dev CI for `development` and `feature/*` (build + test only)
- `preview-release.yml` -- Auto pre-release on push to `preview`
- `production-release.yml` -- Auto release on push to `{{MAIN_BRANCH}}`

| Environment | Test Results | Build Artifacts | Retention |
|-------------|-------------|-----------------|-----------|
| Dev/Feature | Only on failure | None | 3 days |
| Preview | Always | Release package + GitHub Pre-release | 90 days |
| Production | Always | Release package + GitHub Release | 90 days |

Version is managed via `Version.props` (`MajorVersion`, `MinorVersion`, `PatchVersion`).

## Session Start Protocol

At the start of every session:
1. Read `docs/features/ACTIVE_WORK.md` if it exists
2. Check auto memory (`MEMORY.md`) for prior context
3. Run `git log --oneline -10` and `git status` to understand current state
4. Ask the user what they'd like to work on before making assumptions

Before ending a session or when context is getting long:
1. Update `docs/features/ACTIVE_WORK.md` with current progress, decisions made, and next steps
2. Save any important patterns or learnings to auto memory

## Branching Strategy

```
{{MAIN_BRANCH}} <-- Stable releases (X.Y.Z)
  ^ PR
preview <------ Pre-release testing (X.Y.Z-preview.N)
  ^ PR
development <-- Integration (X.Y.Z-dev.N)
  ^ PR
feature/* ----- Development work (X.Y.Z-dev.N)
```

Flow: `feature/*` -> `development` -> `preview` -> `{{MAIN_BRANCH}}` (all via PR)

### Branch Protection Rules -- NEVER VIOLATE

- **NEVER commit directly to `{{MAIN_BRANCH}}`, `preview`, or `development`.** All changes must come through PRs.
- **NEVER push directly to protected branches.** No force-pushes, no direct commits, no exceptions.
- **NEVER create or merge a PR without explicit user confirmation.** Draft PRs are acceptable without confirmation.
- **All development work happens on `feature/*` branches.** Direct commits are only allowed here.

## Architecture
<!-- Add project-specific architecture here, or use @docs/ARCHITECTURE.md for detailed breakdowns -->

## Key Patterns
<!-- Add project-specific patterns here -->

## Platform Constraints
<!-- Add project-specific constraints here -->

## Development Workflow

**MANDATORY:** Every feature branch MUST use persona-driven development. No exceptions.

Before writing ANY code on a feature branch:
1. Ensure a GitHub issue exists
2. Create `docs/features/<feature>/tasks.md` (gate -- no code without this file)
3. Choose a loop pattern based on feature size:

### Subagent Loop (Recommended for multi-phase features)

Parallel persona review via the `Task` tool. Launches REVIEWER + TESTER + SECURITY as simultaneous subagents with per-persona model hints (opus for judgment, sonnet for execution, haiku for coordination).

```
Implement (sonnet) → Review in parallel (opus+sonnet+opus) → Fix → PM update → repeat
```

See `docs/prompts/templates/SUBAGENT_LOOP.md` for copy-paste prompts and full documentation.

### Ralph Loop (For smaller features)

Single-context rotating persona pattern via `/ralph-loop`. One persona per iteration, cycling through IMPLEMENTER → REVIEWER → TESTER → UI_UX → SECURITY → PM.

See `docs/prompts/templates/ROTATING_FEATURE.md` for full Ralph Loop documentation.

Commit with persona prefix: `[IMPLEMENTER]`, `[REVIEWER]`, `[TESTER]`, etc.
Completion requires all tasks done, build + tests passing, and at least **1 clean review cycle**.

## Extended Documentation

Read these files on demand (not loaded every session):
- **Architecture:** `@docs/ARCHITECTURE.md` -- Solution structure, key files, dependencies
- **Subagent Loop:** `@docs/prompts/templates/SUBAGENT_LOOP.md` -- Parallel persona review for multi-phase features
- **Ralph Loop:** `@docs/prompts/README.md` -- Single-context rotating persona workflow
- **Personas:** `@docs/prompts/PERSONAS.md` -- 11 development personas with model hints
- **Release Process:** `@docs/RELEASE_PROCESS.md` -- Version numbering and release workflow
